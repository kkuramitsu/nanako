<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanako („Å™„Å™„Åì) Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
            transition: background 0.3s;
        }

        body.dark {
            background: #1e1e1e;
            color: #d4d4d4;
        }

        .header {
            background: #2d2d30;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5em;
            font-weight: 300;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #007acc;
            color: white;
        }

        .btn-primary:hover {
            background: #005a9e;
        }

        .btn-secondary {
            background: #5a5a5a;
            color: white;
        }

        .btn-secondary:hover {
            background: #6a6a6a;
        }

        .theme-toggle {
            background: #444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .editor-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #ddd;
        }

        body.dark .editor-panel {
            border-right-color: #3e3e3e;
        }

        .editor-toolbar {
            background: #f8f8f8;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        body.dark .editor-toolbar {
            background: #2d2d30;
            border-bottom-color: #3e3e3e;
        }

        .example-select {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }

        body.dark .example-select {
            background: #3c3c3c;
            color: #d4d4d4;
            border-color: #555;
        }

        .editor-container {
            flex: 1;
            position: relative;
        }

        #editor {
            width: 100%;
            height: 100%;
        }

        .output-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background: white;
        }

        body.dark .output-panel {
            background: #252526;
        }

        .output-tabs {
            display: flex;
            background: #f8f8f8;
            border-bottom: 1px solid #ddd;
        }

        body.dark .output-tabs {
            background: #2d2d30;
            border-bottom-color: #3e3e3e;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            font-size: 14px;
        }

        .tab:hover {
            background: rgba(0,0,0,0.05);
        }

        body.dark .tab:hover {
            background: rgba(255,255,255,0.05);
        }

        .tab.active {
            border-bottom-color: #007acc;
            background: white;
        }

        body.dark .tab.active {
            background: #252526;
        }

        .tab-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .output-content {
            color: #333;
        }

        body.dark .output-content {
            color: #d4d4d4;
        }

        .error {
            color: #e74c3c;
            background: #ffeaea;
            padding: 10px;
            border-left: 4px solid #e74c3c;
            margin: 10px 0;
            border-radius: 4px;
        }

        body.dark .error {
            background: #2d1b1b;
            color: #ff6b6b;
        }

        .stats {
            color: #666;
            font-size: 13px;
            margin-top: 10px;
        }

        body.dark .stats {
            color: #999;
        }

        .json-output {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e1e1e1;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            color: #333;
        }

        body.dark .json-output {
            background: #1e1e1e;
            border-color: #3e3e3e;
            color: #d4d4d4;
        }

        .print-output {
            border-left: 3px solid #007acc;
            padding-left: 10px;
            margin: 8px 0;
            color: #2c3e50;
        }

        body.dark .print-output {
            color: #a8c8e6;
        }

        .loading {
            display: none;
            color: #666;
            font-style: italic;
        }

        body.dark .loading {
            color: #999;
        }

        .resizer {
            width: 4px;
            background: #ddd;
            cursor: col-resize;
            position: relative;
            z-index: 10;
        }

        body.dark .resizer {
            background: #3e3e3e;
        }

        .resizer:hover {
            background: #007acc;
        }

        .fallback-editor {
            width: 100%;
            height: 100%;
            border: none;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
            background: white;
            color: #333;
        }

        body.dark .fallback-editor {
            background: #1e1e1e;
            color: #d4d4d4;
        }

        /* Error highlighting styles */
        .error-line {
            background-color: rgba(255, 0, 0, 0.1);
            border-left: 4px solid #e74c3c;
        }

        body.dark .error-line {
            background-color: rgba(255, 0, 0, 0.2);
        }

        .error-glyph {
            background-color: #e74c3c;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            margin-left: 4px;
            margin-top: 2px;
        }

        .error-glyph::after {
            content: "!";
            color: white;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .editor-panel, .output-panel {
                width: 100%;
                height: 50%;
            }
            
            .resizer {
                width: 100%;
                height: 4px;
                cursor: row-resize;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>Nanako („Å™„Å™„Åì) Editor</h1>
            <span id="version-display" style="font-size: 0.8em; color: #999; margin-left: 10px;"></span>
        </div>
        <div class="header-controls">
            <button class="btn btn-primary" onclick="executeCode()">ÂÆüË°å (Ctrl+Enter)</button>
            <button class="btn btn-secondary" onclick="clearOutput()">„ÇØ„É™„Ç¢</button>
            <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
        </div>
    </div>

    <div class="main-container">
        <div class="editor-panel">
            <div class="editor-toolbar">
                <label for="examples">‰æãÔºö</label>
                <select id="examples" class="example-select" onchange="loadExample()">
                    <option value="">-- ‰æã„ÇíÈÅ∏Êäû --</option>
                    <option value="basic">Âü∫Êú¨Êìç‰Ωú</option>
                    <option value="loop">„Åè„ÇäËøî„Åó</option>
                    <option value="function">Èñ¢Êï∞ÂÆöÁæ©</option>
                    <option value="gcd">ÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞</option>
                    <option value="array">ÈÖçÂàóÊìç‰Ωú</option>
                    <option value="recursive">ÂÜçÂ∏∞Èñ¢Êï∞</option>
                    <option value="bubblesort">„Éê„Éñ„É´„ÇΩ„Éº„Éà</option>
                    <option value="quicksort">„ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„Éà</option>
                    <option value="lifegame">„É©„Ç§„Éï„Ç≤„Éº„É†</option>
                    <option value="rot13">ROT13ÊöóÂè∑</option>
                </select>
                <span style="margin-left: 10px; color: #666; font-size: 12px;">
                    Ctrl+Enter „ÅßÂÆüË°å
                </span>
            </div>
            <div class="editor-container">
                <div id="editor"></div>
                <textarea id="fallback-editor" class="fallback-editor" style="display: none;" placeholder="Nanako „Éó„É≠„Ç∞„É©„É†„Çí„Åì„Åì„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
            </div>
        </div>

        <div class="resizer" id="resizer"></div>

        <div class="output-panel">
            <div class="output-tabs">
                <div class="tab active" onclick="switchTab('output')">Âá∫Âäõ</div>
                <div class="tab" onclick="switchTab('javascript')">JavaScript</div>
                <div class="tab" onclick="switchTab('python')">Python</div>
            </div>
            <div class="tab-content">
                <div id="output-content" class="output-content">
                    <div style="color: #666; font-style: italic;">
                        „Éó„É≠„Ç∞„É©„É†„ÇíÂÆüË°å„Åô„Çã„Å®ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                    </div>
                </div>
                <div class="loading" id="loading">ÂÆüË°å‰∏≠...</div>
            </div>
        </div>
    </div>

    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <script src="nanako.js"></script>
    <script>
        let monacoEditor = null;
        let currentTab = 'output';
        let isDarkTheme = false;
        let runtime = null;
        let outputs = [];
        let errorDecorations = [];
        let lastExecutedCode = '';
        let lastExecutionResult = null;

        const examples = {
            basic: `# Âü∫Êú¨ÁöÑ„Å™Êìç‰Ωú
x = 10
y = 5

# Â¢ó„ÇÑ„Åô„ÉªÊ∏õ„Çâ„Åô
x„ÇíÂ¢ó„ÇÑ„Åô
y„ÇíÊ∏õ„Çâ„Åô

x
y`,

            array: `# ÈÖçÂàó„ÅÆÊìç‰Ωú
Êï∞Âàó = [1, 2, 3, 4, 5]
ÊñáÂ≠óÂàó = "Hello"

# ÈÖçÂàó„ÅÆË¶ÅÁ¥†„ÇíÂèñÂæó
Êï∞Âàó[0]
Êï∞Âàó[2]

# ÊñáÂ≠óÂàó„ÅØÊñáÂ≠ó„Ç≥„Éº„Éâ„ÅÆÈÖçÂàó
ÊñáÂ≠óÂàó[0]
ÊñáÂ≠óÂàó[1]

# ÈÖçÂàó„ÅÆÈï∑„Åï
|Êï∞Âàó|
|ÊñáÂ≠óÂàó|`,

            function: `# Èñ¢Êï∞ÂÆöÁæ©„ÅÆ‰æã
Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

# Áµ∂ÂØæÂÄ§Èñ¢Êï∞
Áµ∂ÂØæÂÄ§ = ÂÖ•Âäõ X „Å´ÂØæ„Åó {
    „ÇÇ„ÅóX„Åå0„Çà„ÇäÂ∞è„Åï„ÅÑ„Å™„Çâ„Å∞„ÄÅ{
        -X„ÅåÁ≠î„Åà
    }
    „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞ {
        X„ÅåÁ≠î„Åà
    }
}

# Èñ¢Êï∞„ÇíÂëº„Å≥Âá∫„Åó
result1 = Ë∂≥„ÅóÁÆó(3, 4)
result2 = Áµ∂ÂØæÂÄ§(-5)

result1
result2`,

            loop: `# „É´„Éº„ÉóÂá¶ÁêÜ
count = 0

# 5ÂõûÁπ∞„ÇäËøî„Åô
5Âõû„ÄÅ„Åè„ÇäËøî„Åô {
    count„ÇíÂ¢ó„ÇÑ„Åô
}

count

# ÈÖçÂàó„ÅÆÂêÑË¶ÅÁ¥†„ÇíÂá¶ÁêÜ
numbers = [10, 20, 30]
sum = 0
i = 0

|numbers|Âõû„ÄÅ„Åè„ÇäËøî„Åô {
    sum = Ë∂≥„ÅóÁÆó(sum, numbers[i])
    i„ÇíÂ¢ó„ÇÑ„Åô
}

Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

sum`,

            recursive: `# ÂÜçÂ∏∞Èñ¢Êï∞„Å´„Çà„ÇãÈöé‰πó
Èöé‰πó = ÂÖ•Âäõ n „Å´ÂØæ„Åó {
    „ÇÇ„Åó n „Åå 1 ‰ª•‰∏ã„Å™„Çâ„Å∞„ÄÅ{
        1„ÅåÁ≠î„Åà
    }
    „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„ÄÅ{
        Êéõ„ÅëÁÆó(n, Èöé‰πó(Ê∏õ„Çâ„Åô(n)))„ÅåÁ≠î„Åà
    }
}

Êéõ„ÅëÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    result = 0
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        result = Ë∂≥„ÅóÁÆó(result, X)
    }
    result„ÅåÁ≠î„Åà
}

Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Ê∏õ„Çâ„Åô = ÂÖ•Âäõ X „Å´ÂØæ„Åó {
    X„ÇíÊ∏õ„Çâ„Åô
    X„ÅåÁ≠î„Åà
}

# 5„ÅÆÈöé‰πó„ÇíË®àÁÆó
result = Èöé‰πó(5)
result`,

            gcd: `# „É¶„Éº„ÇØ„É™„ÉÉ„Éâ‰∫íÈô§Ê≥ï„Å´„Çà„ÇãÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞
ÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞ = ÂÖ•Âäõ a, b „Å´ÂØæ„Åó {
    „ÇÇ„Åó b „Åå 0 „Å™„Çâ„Å∞„ÄÅ{
        a„ÅåÁ≠î„Åà
    }
    „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„ÄÅ{
        ÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞(b, „ÅÇ„Åæ„Çä(a, b))„ÅåÁ≠î„Åà
    }
}

„ÅÇ„Åæ„Çä = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    „ÇÇ„Åó X „Åå Y „Çà„ÇäÂ∞è„Åï„ÅÑ„Å™„Çâ„Å∞„ÄÅ{
        X„ÅåÁ≠î„Åà
    }
    „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„ÄÅ{
        „ÅÇ„Åæ„Çä(Âºï„ÅçÁÆó(X, Y), Y)„ÅåÁ≠î„Åà
    }
}

Âºï„ÅçÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÊ∏õ„Çâ„Åô
    }
    X„ÅåÁ≠î„Åà
}

# 60„Å®48„ÅÆÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞
result = ÊúÄÂ§ßÂÖ¨Á¥ÑÊï∞(60, 48)
result`,

            bubblesort: `# „Éê„Éñ„É´„ÇΩ„Éº„Éà
# ÈÖçÂàó„Çí„ÇΩ„Éº„Éà„Åô„ÇãÈñ¢Êï∞
„Éê„Éñ„É´„ÇΩ„Éº„Éà = ÂÖ•Âäõ ÈÖçÂàó „Å´ÂØæ„Åó {
    n = |ÈÖçÂàó|
    
    # Â§ñÂÅ¥„É´„Éº„Éó: n-1ÂõûÁπ∞„ÇäËøî„Åó
    Âºï„ÅçÁÆó(n, 1)Âõû„ÄÅ„Åè„ÇäËøî„Åô {
        ‰∫§Êèõ„Éï„É©„Ç∞ = 0
        i = 0
        
        # ÂÜÖÂÅ¥„É´„Éº„Éó: Èö£Êé•Ë¶ÅÁ¥†„ÇíÊØîËºÉ
        Âºï„ÅçÁÆó(n, 1)Âõû„ÄÅ„Åè„ÇäËøî„Åô {
            „ÇÇ„Åó ÈÖçÂàó[i] „Åå ÈÖçÂàó[Ë∂≥„ÅóÁÆó(i, 1)] „Çà„ÇäÂ§ß„Åç„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
                # Ë¶ÅÁ¥†„Çí‰∫§Êèõ
                temp = ÈÖçÂàó[i]
                ÈÖçÂàó[i] = ÈÖçÂàó[Ë∂≥„ÅóÁÆó(i, 1)]
                ÈÖçÂàó[Ë∂≥„ÅóÁÆó(i, 1)] = temp
                ‰∫§Êèõ„Éï„É©„Ç∞ = 1
            }
            i„ÇíÂ¢ó„ÇÑ„Åô
        }
        
        # ‰∫§Êèõ„Åå„Å™„Åã„Å£„ÅüÂ†¥Âêà„ÅØÂÆå‰∫Ü
        „ÇÇ„Åó ‰∫§Êèõ„Éï„É©„Ç∞ „Åå 0 „Å™„Çâ„Å∞„ÄÅ{
            # Êó©ÊúüÁµÇ‰∫ÜÔºàÊúÄÈÅ©ÂåñÔºâ
        }
    }
    
    ÈÖçÂàó„ÅåÁ≠î„Åà
}

# ÂøÖË¶Å„Å™Ë£úÂä©Èñ¢Êï∞
Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Âºï„ÅçÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÊ∏õ„Çâ„Åô
    }
    X„ÅåÁ≠î„Åà
}

# „ÇΩ„Éº„Éà„Åô„ÇãÈÖçÂàó
Êï∞Âàó = [64, 34, 25, 12, 22, 11, 90]

# „ÇΩ„Éº„ÉàÂâç
Êï∞Âàó

# „Éê„Éñ„É´„ÇΩ„Éº„ÉàÂÆüË°å
„ÇΩ„Éº„ÉàÊ∏à„Åø = „Éê„Éñ„É´„ÇΩ„Éº„Éà(Êï∞Âàó)

# „ÇΩ„Éº„ÉàÂæå
„ÇΩ„Éº„ÉàÊ∏à„Åø`,

            quicksort: `# „ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„ÉàÔºàÂÜçÂ∏∞ÁâàÔºâ
# ÈÖçÂàó„ÅÆ‰∏ÄÈÉ®„Çí„ÇΩ„Éº„Éà„Åô„ÇãÈñ¢Êï∞
„ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„Éà = ÂÖ•Âäõ ÈÖçÂàó, ÈñãÂßã, ÁµÇ‰∫Ü „Å´ÂØæ„Åó {
    „ÇÇ„Åó ÈñãÂßã „Åå ÁµÇ‰∫Ü „Çà„ÇäÂ∞è„Åï„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
        # „Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥Êìç‰Ωú
        Â¢ÉÁïå = „Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥(ÈÖçÂàó, ÈñãÂßã, ÁµÇ‰∫Ü)
        
        # Â∑¶ÂÅ¥„ÇíÂÜçÂ∏∞ÁöÑ„Å´„ÇΩ„Éº„Éà
        „ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„Éà(ÈÖçÂàó, ÈñãÂßã, Âºï„ÅçÁÆó(Â¢ÉÁïå, 1))
        
        # Âè≥ÂÅ¥„ÇíÂÜçÂ∏∞ÁöÑ„Å´„ÇΩ„Éº„Éà
        „ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„Éà(ÈÖçÂàó, Ë∂≥„ÅóÁÆó(Â¢ÉÁïå, 1), ÁµÇ‰∫Ü)
    }
    ÈÖçÂàó„ÅåÁ≠î„Åà
}

# „Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥Êìç‰ΩúÔºà„Éî„Éú„ÉÉ„Éà„Çà„ÇäÂ∞è„Åï„ÅÑË¶ÅÁ¥†„ÇíÂ∑¶„Å´ÁßªÂãïÔºâ
„Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥ = ÂÖ•Âäõ ÈÖçÂàó, ÈñãÂßã, ÁµÇ‰∫Ü „Å´ÂØæ„Åó {
    # ÊúÄÂæå„ÅÆË¶ÅÁ¥†„Çí„Éî„Éú„ÉÉ„Éà„Å®„Åô„Çã
    „Éî„Éú„ÉÉ„Éà = ÈÖçÂàó[ÁµÇ‰∫Ü]
    i = ÈñãÂßã
    j = ÈñãÂßã
    
    # j „Åã„Çâ ÁµÇ‰∫Ü-1 „Åæ„ÅßÂá¶ÁêÜ
    Âºï„ÅçÁÆó(ÁµÇ‰∫Ü, ÈñãÂßã)Âõû„ÄÅ„Åè„ÇäËøî„Åô {
        „ÇÇ„Åó ÈÖçÂàó[j] „Åå „Éî„Éú„ÉÉ„Éà „Çà„ÇäÂ∞è„Åï„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
            # Ë¶ÅÁ¥†„Çí‰∫§Êèõ
            temp = ÈÖçÂàó[i]
            ÈÖçÂàó[i] = ÈÖçÂàó[j]
            ÈÖçÂàó[j] = temp
            i„ÇíÂ¢ó„ÇÑ„Åô
        }
        j„ÇíÂ¢ó„ÇÑ„Åô
    }
    
    # „Éî„Éú„ÉÉ„Éà„ÇíÊ≠£„Åó„ÅÑ‰ΩçÁΩÆ„Å´ÈÖçÁΩÆ
    temp = ÈÖçÂàó[i]
    ÈÖçÂàó[i] = ÈÖçÂàó[ÁµÇ‰∫Ü]
    ÈÖçÂàó[ÁµÇ‰∫Ü] = temp
    
    i„ÅåÁ≠î„Åà
}

# ÈÖçÂàóÂÖ®‰Ωì„Çí„ÇΩ„Éº„Éà„Åô„Çã‰æøÂà©Èñ¢Êï∞
ÈÖçÂàó„ÇΩ„Éº„Éà = ÂÖ•Âäõ ÈÖçÂàó „Å´ÂØæ„Åó {
    Èï∑„Åï = |ÈÖçÂàó|
    „ÇÇ„Åó Èï∑„Åï „Åå 1 „Çà„ÇäÂ§ß„Åç„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
        „ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„Éà(ÈÖçÂàó, 0, Âºï„ÅçÁÆó(Èï∑„Åï, 1))
    }
    ÈÖçÂàó„ÅåÁ≠î„Åà
}

# ÂøÖË¶Å„Å™Ë£úÂä©Èñ¢Êï∞
Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Âºï„ÅçÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÊ∏õ„Çâ„Åô
    }
    X„ÅåÁ≠î„Åà
}

# „ÇΩ„Éº„Éà„Åô„ÇãÈÖçÂàó
Êï∞Âàó = [38, 27, 43, 3, 9, 82, 10]

# „ÇΩ„Éº„ÉàÂâç
Êï∞Âàó

# „ÇØ„Ç§„ÉÉ„ÇØ„ÇΩ„Éº„ÉàÂÆüË°å
„ÇΩ„Éº„ÉàÊ∏à„Åø = ÈÖçÂàó„ÇΩ„Éº„Éà(Êï∞Âàó)

# „ÇΩ„Éº„ÉàÂæå
„ÇΩ„Éº„ÉàÊ∏à„Åø`,

            lifegame: `# Conway's Life Game („É©„Ç§„Éï„Ç≤„Éº„É†)
# 5x5„ÅÆ„Ç∞„É™„ÉÉ„Éâ„Åß3‰∏ñ‰ª£ÂÆüË°å

# „Çª„É´„ÅÆÁä∂ÊÖã„ÇíÂèñÂæóÔºàÂ¢ÉÁïåÂ§ñ„ÅØ0Ôºâ
„Çª„É´ÂèñÂæó = ÂÖ•Âäõ Áõ§Èù¢, Ë°å, Âàó „Å´ÂØæ„Åó {
    „ÇÇ„Åó Ë°å „Åå 0 „Çà„ÇäÂ∞è„Åï„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
        0„ÅåÁ≠î„Åà
    }
    „ÇÇ„Åó Âàó „Åå 0 „Çà„ÇäÂ∞è„Åï„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
        0„ÅåÁ≠î„Åà
    }
    „ÇÇ„Åó Ë°å „Åå 5 ‰ª•‰∏ä „Å™„Çâ„Å∞„ÄÅ{
        0„ÅåÁ≠î„Åà
    }
    „ÇÇ„Åó Âàó „Åå 5 ‰ª•‰∏ä „Å™„Çâ„Å∞„ÄÅ{
        0„ÅåÁ≠î„Åà
    }
    # 2Ê¨°ÂÖÉÈÖçÂàó„Ç¢„ÇØ„Çª„Çπ: board[row * 5 + col]
    „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ = Ë∂≥„ÅóÁÆó(Êéõ„ÅëÁÆó(Ë°å, 5), Âàó)
    Áõ§Èù¢[„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ]„ÅåÁ≠î„Åà
}

# Èö£Êé•„Åô„ÇãÁîü„Åç„Å¶„ÅÑ„Çã„Çª„É´„ÅÆÊï∞„Çí„Ç´„Ç¶„É≥„Éà
Èö£Êé•„Ç´„Ç¶„É≥„Éà = ÂÖ•Âäõ Áõ§Èù¢, Ë°å, Âàó „Å´ÂØæ„Åó {
    „Ç´„Ç¶„É≥„Éà = 0
    
    # 8ÊñπÂêë„Çí„ÉÅ„Çß„ÉÉ„ÇØ
    # ‰∏ä
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Âºï„ÅçÁÆó(Ë°å, 1), Âºï„ÅçÁÆó(Âàó, 1)))
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Âºï„ÅçÁÆó(Ë°å, 1), Âàó))
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Âºï„ÅçÁÆó(Ë°å, 1), Ë∂≥„ÅóÁÆó(Âàó, 1)))
    
    # Â∑¶Âè≥
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Ë°å, Âºï„ÅçÁÆó(Âàó, 1)))
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Ë°å, Ë∂≥„ÅóÁÆó(Âàó, 1)))
    
    # ‰∏ã
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Ë∂≥„ÅóÁÆó(Ë°å, 1), Âºï„ÅçÁÆó(Âàó, 1)))
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Ë∂≥„ÅóÁÆó(Ë°å, 1), Âàó))
    „Ç´„Ç¶„É≥„Éà = Ë∂≥„ÅóÁÆó(„Ç´„Ç¶„É≥„Éà, „Çª„É´ÂèñÂæó(Áõ§Èù¢, Ë∂≥„ÅóÁÆó(Ë°å, 1), Ë∂≥„ÅóÁÆó(Âàó, 1)))
    
    „Ç´„Ç¶„É≥„Éà„ÅåÁ≠î„Åà
}

# Ê¨°„ÅÆ‰∏ñ‰ª£„ÇíË®àÁÆó
Ê¨°‰∏ñ‰ª£Ë®àÁÆó = ÂÖ•Âäõ ÁèæÂú®Áõ§Èù¢ „Å´ÂØæ„Åó {
    Êñ∞Áõ§Èù¢ = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    Ë°å = 0
    
    5Âõû„ÄÅ„Åè„ÇäËøî„Åô {
        Âàó = 0
        5Âõû„ÄÅ„Åè„ÇäËøî„Åô {
            ÁèæÂú®„Çª„É´ = „Çª„É´ÂèñÂæó(ÁèæÂú®Áõ§Èù¢, Ë°å, Âàó)
            Èö£Êé•Êï∞ = Èö£Êé•„Ç´„Ç¶„É≥„Éà(ÁèæÂú®Áõ§Èù¢, Ë°å, Âàó)
            „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ = Ë∂≥„ÅóÁÆó(Êéõ„ÅëÁÆó(Ë°å, 5), Âàó)
            
            # „É©„Ç§„Éï„Ç≤„Éº„É†„ÅÆ„É´„Éº„É´
            „ÇÇ„Åó ÁèæÂú®„Çª„É´ „Åå 1 „Å™„Çâ„Å∞„ÄÅ{
                # Áîü„Åç„Å¶„ÅÑ„Çã„Çª„É´
                „ÇÇ„Åó Èö£Êé•Êï∞ „Åå 2 „Å™„Çâ„Å∞„ÄÅ{
                    Êñ∞Áõ§Èù¢[„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ] = 1  # ÁîüÂ≠ò
                }
                „ÇÇ„Åó Èö£Êé•Êï∞ „Åå 3 „Å™„Çâ„Å∞„ÄÅ{
                    Êñ∞Áõ§Èù¢[„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ] = 1  # ÁîüÂ≠ò
                }
            }
            „Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞„ÄÅ{
                # Ê≠ª„Çì„Åß„ÅÑ„Çã„Çª„É´
                „ÇÇ„Åó Èö£Êé•Êï∞ „Åå 3 „Å™„Çâ„Å∞„ÄÅ{
                    Êñ∞Áõ§Èù¢[„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ] = 1  # Ë™ïÁîü
                }
            }
            
            Âàó„ÇíÂ¢ó„ÇÑ„Åô
        }
        Ë°å„ÇíÂ¢ó„ÇÑ„Åô
    }
    
    Êñ∞Áõ§Èù¢„ÅåÁ≠î„Åà
}

# ÂøÖË¶Å„Å™Ë£úÂä©Èñ¢Êï∞
Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Âºï„ÅçÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÊ∏õ„Çâ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Êéõ„ÅëÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    ÁµêÊûú = 0
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        ÁµêÊûú = Ë∂≥„ÅóÁÆó(ÁµêÊûú, X)
    }
    ÁµêÊûú„ÅåÁ≠î„Åà
}

# ÂàùÊúü„Éë„Çø„Éº„É≥Ôºà„Ç∞„É©„Ç§„ÉÄ„ÉºÔºâ
# [0,0,0,0,0]  ‚ñ°‚ñ°‚ñ°‚ñ°‚ñ°
# [0,1,0,0,0]  ‚ñ°‚ñ†‚ñ°‚ñ°‚ñ°
# [0,0,1,1,0]  ‚ñ°‚ñ°‚ñ†‚ñ†‚ñ°
# [0,1,1,0,0]  ‚ñ°‚ñ†‚ñ†‚ñ°‚ñ°
# [0,0,0,0,0]  ‚ñ°‚ñ°‚ñ°‚ñ°‚ñ°
Áõ§Èù¢0 = [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0]

# ÂêÑ‰∏ñ‰ª£„ÅÆÁä∂ÊÖã
Áõ§Èù¢0
Áõ§Èù¢1 = Ê¨°‰∏ñ‰ª£Ë®àÁÆó(Áõ§Èù¢0)
Áõ§Èù¢1
Áõ§Èù¢2 = Ê¨°‰∏ñ‰ª£Ë®àÁÆó(Áõ§Èù¢1)
Áõ§Èù¢2
Áõ§Èù¢3 = Ê¨°‰∏ñ‰ª£Ë®àÁÆó(Áõ§Èù¢2)
Áõ§Èù¢3`,

            rot13: `# ROT13 ÊöóÂè∑Âåñ„ÉªÂæ©Âè∑Âåñ
# „Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„Çí13ÊñáÂ≠ó„Åö„Çâ„ÅôÊöóÂè∑

# ÊñáÂ≠ó„ÅåÂ§ßÊñáÂ≠ó„ÅÆA-Z„Åã„ÉÅ„Çß„ÉÉ„ÇØ
Â§ßÊñáÂ≠óÂà§ÂÆö = ÂÖ•Âäõ ÊñáÂ≠ó„Ç≥„Éº„Éâ „Å´ÂØæ„Åó {
    # A=65, Z=90
    „ÇÇ„Åó ÊñáÂ≠ó„Ç≥„Éº„Éâ „Åå 65 ‰ª•‰∏ä „Å™„Çâ„Å∞„ÄÅ{
        „ÇÇ„Åó ÊñáÂ≠ó„Ç≥„Éº„Éâ „Åå 90 ‰ª•‰∏ã „Å™„Çâ„Å∞„ÄÅ{
            1„ÅåÁ≠î„Åà
        }
    }
    0„ÅåÁ≠î„Åà
}

# ÊñáÂ≠ó„ÅåÂ∞èÊñáÂ≠ó„ÅÆa-z„Åã„ÉÅ„Çß„ÉÉ„ÇØ  
Â∞èÊñáÂ≠óÂà§ÂÆö = ÂÖ•Âäõ ÊñáÂ≠ó„Ç≥„Éº„Éâ „Å´ÂØæ„Åó {
    # a=97, z=122
    „ÇÇ„Åó ÊñáÂ≠ó„Ç≥„Éº„Éâ „Åå 97 ‰ª•‰∏ä „Å™„Çâ„Å∞„ÄÅ{
        „ÇÇ„Åó ÊñáÂ≠ó„Ç≥„Éº„Éâ „Åå 122 ‰ª•‰∏ã „Å™„Çâ„Å∞„ÄÅ{
            1„ÅåÁ≠î„Åà
        }
    }
    0„ÅåÁ≠î„Åà
}

# ROT13Â§âÊèõÔºà1ÊñáÂ≠óÔºâ
ÊñáÂ≠óROT13 = ÂÖ•Âäõ ÊñáÂ≠ó„Ç≥„Éº„Éâ „Å´ÂØæ„Åó {
    „ÇÇ„Åó Â§ßÊñáÂ≠óÂà§ÂÆö(ÊñáÂ≠ó„Ç≥„Éº„Éâ) „Åå 1 „Å™„Çâ„Å∞„ÄÅ{
        # Â§ßÊñáÂ≠ó„ÅÆÂ†¥ÂêàÔºöA(65)„ÇíÂü∫Ê∫ñ„Å´13„Åö„Çâ„Åô
        Áõ∏ÂØæ‰ΩçÁΩÆ = Âºï„ÅçÁÆó(ÊñáÂ≠ó„Ç≥„Éº„Éâ, 65)
        Êñ∞‰ΩçÁΩÆ = „ÅÇ„Åæ„Çä(Ë∂≥„ÅóÁÆó(Áõ∏ÂØæ‰ΩçÁΩÆ, 13), 26)
        Ë∂≥„ÅóÁÆó(Êñ∞‰ΩçÁΩÆ, 65)„ÅåÁ≠î„Åà
    }
    
    „ÇÇ„Åó Â∞èÊñáÂ≠óÂà§ÂÆö(ÊñáÂ≠ó„Ç≥„Éº„Éâ) „Åå 1 „Å™„Çâ„Å∞„ÄÅ{
        # Â∞èÊñáÂ≠ó„ÅÆÂ†¥ÂêàÔºöa(97)„ÇíÂü∫Ê∫ñ„Å´13„Åö„Çâ„Åô
        Áõ∏ÂØæ‰ΩçÁΩÆ = Âºï„ÅçÁÆó(ÊñáÂ≠ó„Ç≥„Éº„Éâ, 97)
        Êñ∞‰ΩçÁΩÆ = „ÅÇ„Åæ„Çä(Ë∂≥„ÅóÁÆó(Áõ∏ÂØæ‰ΩçÁΩÆ, 13), 26)
        Ë∂≥„ÅóÁÆó(Êñ∞‰ΩçÁΩÆ, 97)„ÅåÁ≠î„Åà
    }
    
    # „Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà‰ª•Â§ñ„ÅØ„Åù„ÅÆ„Åæ„Åæ
    ÊñáÂ≠ó„Ç≥„Éº„Éâ„ÅåÁ≠î„Åà
}

# ÊñáÂ≠óÂàóÂÖ®‰Ωì„ÇíROT13Â§âÊèõ
ÊñáÂ≠óÂàóROT13 = ÂÖ•Âäõ ÊñáÂ≠óÂàó „Å´ÂØæ„Åó {
    ÁµêÊûú = []
    i = 0
    Èï∑„Åï = |ÊñáÂ≠óÂàó|
    
    Èï∑„ÅïÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        ÂÖÉÊñáÂ≠ó = ÊñáÂ≠óÂàó[i]
        Êñ∞ÊñáÂ≠ó = ÊñáÂ≠óROT13(ÂÖÉÊñáÂ≠ó)
        ÁµêÊûú[?] = Êñ∞ÊñáÂ≠ó
        i„ÇíÂ¢ó„ÇÑ„Åô
    }
    
    ÁµêÊûú„ÅåÁ≠î„Åà
}

# Ââ∞‰ΩôË®àÁÆóÔºàÂâ≤„ÇäÁÆó„ÅÆ‰Ωô„ÇäÔºâ
„ÅÇ„Åæ„Çä = ÂÖ•Âäõ Ë¢´Èô§Êï∞, Èô§Êï∞ „Å´ÂØæ„Åó {
    „ÇÇ„Åó Ë¢´Èô§Êï∞ „Åå Èô§Êï∞ „Çà„ÇäÂ∞è„Åï„ÅÑ „Å™„Çâ„Å∞„ÄÅ{
        Ë¢´Èô§Êï∞„ÅåÁ≠î„Åà
    }
    „ÅÇ„Åæ„Çä(Âºï„ÅçÁÆó(Ë¢´Èô§Êï∞, Èô§Êï∞), Èô§Êï∞)„ÅåÁ≠î„Åà
}

# ÂøÖË¶Å„Å™Ë£úÂä©Èñ¢Êï∞
Ë∂≥„ÅóÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÂ¢ó„ÇÑ„Åô
    }
    X„ÅåÁ≠î„Åà
}

Âºï„ÅçÁÆó = ÂÖ•Âäõ X, Y „Å´ÂØæ„Åó {
    YÂõû„ÄÅ„Åè„ÇäËøî„Åô {
        X„ÇíÊ∏õ„Çâ„Åô
    }
    X„ÅåÁ≠î„Åà
}

# „ÉÜ„Çπ„ÉàÁî®„ÅÆÊñáÂ≠óÂàó
# "Hello World" „ÅÆÊñáÂ≠ó„Ç≥„Éº„ÉâÈÖçÂàó
# H=72, e=101, l=108, l=108, o=111, (space)=32, W=87, o=111, r=114, l=108, d=100
ÂÖÉÊñáÂ≠óÂàó = [72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100]

# ÊöóÂè∑Âåñ
ÊöóÂè∑ÂåñÊñáÂ≠óÂàó = ÊñáÂ≠óÂàóROT13(ÂÖÉÊñáÂ≠óÂàó)

# Âæ©Âè∑ÂåñÔºàROT13„ÅØÂØæÁß∞„Å™„ÅÆ„Åß2ÂõûÈÅ©Áî®„ÅßÂÖÉ„Å´Êàª„ÇãÔºâ
Âæ©Âè∑ÂåñÊñáÂ≠óÂàó = ÊñáÂ≠óÂàóROT13(ÊöóÂè∑ÂåñÊñáÂ≠óÂàó)

# ÁµêÊûúË°®Á§∫
ÂÖÉÊñáÂ≠óÂàó
ÊöóÂè∑ÂåñÊñáÂ≠óÂàó
Âæ©Âè∑ÂåñÊñáÂ≠óÂàó`
        };

        // Initialize Monaco Editor
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            // Define Nanako language
            monaco.languages.register({ id: 'nanako' });
            
            monaco.languages.setMonarchTokensProvider('nanako', {
                tokenizer: {
                    root: [
                        [/#.*$/, 'comment'],
                        // Control flow keywords
                        [/\b(„ÇÇ„Åó|„Å™„Çâ„Å∞|„Åù„ÅÜ„Åß„Å™„Åë„Çå„Å∞|„Åè„ÇäËøî„Åô|Âõû)\b/, 'keyword.control'],
                        // Function keywords
                        [/\b(ÂÖ•Âäõ|„Å´ÂØæ„Åó|„ÅåÁ≠î„Åà|„ÇíÂÆüË°å)\b/, 'keyword.function'],
                        // Variable operation keywords
                        [/\b(„Çí|„Å®„Åô„Çã|Â¢ó„ÇÑ„Åô|Ê∏õ„Çâ„Åô|Âá∫Âäõ)\b/, 'keyword.operator'],
                        // Comparison operators
                        [/\b(‰ª•‰∏ä|‰ª•‰∏ã|„Çà„ÇäÂ§ß„Åç„ÅÑ|„Çà„ÇäÂ∞è„Åï„ÅÑ|‰ª•Â§ñ|Êú™Ê∫Ä)\b/, 'operator.comparison'],
                        // Numbers
                        [/\d+/, 'number'],
                        // Strings
                        [/"([^"\\]|\\.)*"/, 'string'],
                        // Identifiers (Japanese and ASCII)
                        [/[a-zA-Z_\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff][a-zA-Z0-9_\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff]*/, 'identifier'],
                        // Brackets and punctuation
                        [/[{}()\[\]]/, 'bracket'],
                        [/[=+\-*/„ÄÅ,]/, 'operator']
                    ]
                }
            });

            // Define custom color theme for Nanako
            monaco.editor.defineTheme('nanako-light', {
                base: 'vs',
                inherit: true,
                rules: [
                    { token: 'keyword.control', foreground: '0000FF', fontStyle: 'bold' },      // Blue for control flow
                    { token: 'keyword.function', foreground: 'FF6600', fontStyle: 'bold' },    // Orange for functions
                    { token: 'keyword.operator', foreground: 'CC0099', fontStyle: 'bold' },    // Purple for operations
                    { token: 'operator.comparison', foreground: '009900', fontStyle: 'bold' }, // Green for comparisons
                    { token: 'number', foreground: 'FF0000' },                                 // Red for numbers
                    { token: 'string', foreground: 'A31515' },                                 // Dark red for strings
                    { token: 'comment', foreground: '008000', fontStyle: 'italic' },           // Green italic for comments
                ],
                colors: {}
            });

            monaco.editor.defineTheme('nanako-dark', {
                base: 'vs-dark',
                inherit: true,
                rules: [
                    { token: 'keyword.control', foreground: '569CD6', fontStyle: 'bold' },      // Light blue for control flow
                    { token: 'keyword.function', foreground: 'FF9800', fontStyle: 'bold' },     // Orange for functions
                    { token: 'keyword.operator', foreground: 'E91E63', fontStyle: 'bold' },     // Pink for operations
                    { token: 'operator.comparison', foreground: '4CAF50', fontStyle: 'bold' },  // Green for comparisons
                    { token: 'number', foreground: 'F44336' },                                  // Red for numbers
                    { token: 'string', foreground: 'CE9178' },                                  // Light brown for strings
                    { token: 'comment', foreground: '6A9955', fontStyle: 'italic' },            // Green italic for comments
                ],
                colors: {}
            });

            monacoEditor = monaco.editor.create(document.getElementById('editor'), {
                value: '# Nanako („Å™„Å™„Åì) „Éó„É≠„Ç∞„É©„É†„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ\n# ‰æãÈ°å„ÇíÈÅ∏Êäû„Åô„Çã„Åã„ÄÅCtrl+Enter „ÅßÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\nx = 42\nx„ÇíÂ¢ó„ÇÑ„Åô\nx',
                language: 'nanako',
                theme: 'nanako-light',
                fontSize: 14,
                lineNumbers: 'on',
                roundedSelection: false,
                scrollBeyondLastLine: false,
                automaticLayout: true,
                minimap: { enabled: false },
                wordWrap: 'on'
            });

            // Add keyboard shortcut
            monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, function() {
                executeCode();
            });

            // Display version
            displayVersion();
        });

        // Fallback for when Monaco fails to load
        setTimeout(() => {
            if (!monacoEditor) {
                document.getElementById('editor').style.display = 'none';
                document.getElementById('fallback-editor').style.display = 'block';
                document.getElementById('fallback-editor').value = '# Nanako („Å™„Å™„Åì) „Éó„É≠„Ç∞„É©„É†„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ\n\nx = 42\nx„ÇíÂ¢ó„ÇÑ„Åô\nx';
                displayVersion();
            }
        }, 3000);

        function getEditorValue() {
            if (monacoEditor) {
                return monacoEditor.getValue();
            } else {
                return document.getElementById('fallback-editor').value;
            }
        }

        function setEditorValue(value) {
            if (monacoEditor) {
                monacoEditor.setValue(value);
            } else {
                document.getElementById('fallback-editor').value = value;
            }
        }

        function displayVersion() {
            const versionDisplay = document.getElementById('version-display');
            if (versionDisplay && typeof NANAKO_VERSION !== 'undefined') {
                versionDisplay.textContent = `v${NANAKO_VERSION}`;
            }
        }

        function loadExample() {
            const select = document.getElementById('examples');
            const exampleKey = select.value;
            if (exampleKey && examples[exampleKey]) {
                setEditorValue(examples[exampleKey]);
                select.value = '';
                
                // Reset execution state since code changed
                lastExecutedCode = '';
                lastExecutionResult = null;
                clearErrorHighlights();
            }
        }

        function clearErrorHighlights() {
            if (monacoEditor && errorDecorations.length > 0) {
                errorDecorations = monacoEditor.deltaDecorations(errorDecorations, []);
            }
        }

        function highlightErrorLine(line, message) {
            if (monacoEditor) {
                const decorations = [{
                    range: new monaco.Range(line, 1, line, 1),
                    options: {
                        isWholeLine: true,
                        className: 'error-line',
                        glyphMarginClassName: 'error-glyph',
                        hoverMessage: { value: message },
                        minimap: {
                            color: '#ff0000',
                            position: monaco.editor.MinimapPosition.Inline
                        }
                    }
                }];
                errorDecorations = monacoEditor.deltaDecorations(errorDecorations, decorations);
            }
        }

        function parseErrorPosition(error, code) {
            let line = 1;
            let column = 1;
            
            // Try to extract position from error details
            if (error.details && error.details.line) {
                return { line: error.details.line, column: error.details.col || 1 };
            }
            
            // Try to extract line number from error message
            const lineMatch = error.message.match(/line (\d+)/i);
            if (lineMatch) {
                return { line: parseInt(lineMatch[1]), column: 1 };
            }
            
            // If error has pos property, calculate line from position
            if (typeof error.pos === 'number') {
                const lines = code.substring(0, error.pos).split('\n');
                line = lines.length;
                column = lines[lines.length - 1].length + 1;
                return { line, column };
            }
            
            return { line: 1, column: 1 };
        }

        function executeCodeInternal(code, updateDisplay = true) {
            if (!code.trim()) {
                return null;
            }

            try {
                // Initialize runtime
                runtime = new NanakoRuntime();
                
                // Override print function to capture output
                const originalPrint = runtime.print;
                runtime.print = function(value, source, pos, endPos) {
                    const details = errorDetails(source, pos);
                    
                    // ÈÖçÂàó„ÅÆÂ†¥Âêà„ÅØ„Ç≥„Éî„Éº„Çí‰ΩúÊàê„Åó„Å¶ÂèÇÁÖß„ÅÆÂïèÈ°å„ÇíÂõûÈÅø
                    let outputValue = value;
                    if (value instanceof NanakoArray) {
                        outputValue = new NanakoArray([...value.elements]);
                        outputValue.isStringView = value.isStringView;
                    }
                    
                    outputs.push({
                        type: 'print',
                        code: details.lineText.trim(),
                        value: outputValue
                    });
                };

                // Parse and execute
                const parser = new NanakoParser();
                const program = parser.parse(code);
                const env = {};
                
                runtime.start(10); // 10 second timeout
                program.evaluate(runtime, env);

                // Generate output
                let output = '';
                
                // 1. Print outputs
                if (outputs.length > 0) {
                    output += '=== ÂÆüË°åÁµêÊûú ===\n';
                    outputs.forEach(item => {
                        output += `>>> ${item.code}\n`;
                        if (item.value instanceof NanakoArray) {
                            if (item.value.isStringView) {
                                const chars = item.value.elements.map(code => String.fromCharCode(code)).join('');
                                output += `"${chars}"\n`;
                            } else {
                                output += `${item.value.emit('js')}\n`;
                            }
                        } else {
                            output += `${item.value}\n`;
                        }
                        output += '\n';
                    });
                }

                // 2. Runtime statistics
                output += '=== Áµ±Ë®àÊÉÖÂ†± ===\n';
                output += `„Ç§„É≥„ÇØ„É™„É°„É≥„ÉàÂõûÊï∞: ${runtime.incrementCount}\n`;
                output += `„Éá„ÇØ„É™„É°„É≥„ÉàÂõûÊï∞: ${runtime.decrementCount}\n`;
                output += `ÊØîËºÉÂõûÊï∞: ${runtime.compareCount}\n\n`;

                // 3. JSON output
                output += '=== Â§âÊï∞„ÅÆÁä∂ÊÖã (JSON) ===\n';
                output += runtime.stringfyAsJson(env);

                // Generate code for other tabs
                let generatedJS, generatedPython;
                try {
                    generatedJS = program.emit('js', '');
                    generatedPython = program.emit('py', '');
                    console.log('Generated JS length:', generatedJS.length, 'chars');
                    console.log('Generated Python length:', generatedPython.length, 'chars');
                    if (generatedJS.length === 0) console.warn('JS code is empty!');
                    if (generatedPython.length === 0) console.warn('Python code is empty!');
                } catch (e) {
                    console.error('Code generation failed:', e);
                    generatedJS = '// „Ç≥„Éº„ÉâÁîüÊàê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n' + e.message;
                    generatedPython = '# „Ç≥„Éº„ÉâÁîüÊàê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n' + e.message;
                }

                const result = {
                    success: true,
                    output: output,
                    jsCode: generatedJS,
                    pyCode: generatedPython,
                    error: null
                };

                if (updateDisplay && currentTab === 'output') {
                    document.getElementById('output-content').innerHTML = `<div class="output-content">${escapeHtml(output)}</div>`;
                }

                return result;

            } catch (error) {
                // Parse error position and highlight the line
                const errorPos = parseErrorPosition(error, code);
                const errorMessage = `„Ç®„É©„Éº: ${error.message}`;
                const errorOutput = `${errorMessage}<br><small>Ë°å ${errorPos.line}, Âàó ${errorPos.column}</small>`;
                
                const result = {
                    success: false,
                    output: errorOutput,
                    jsCode: '// „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n' + errorMessage,
                    pyCode: '# „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü\n' + errorMessage,
                    error: error,
                    errorPos: errorPos,
                    errorMessage: errorMessage
                };

                if (updateDisplay) {
                    if (currentTab === 'output') {
                        document.getElementById('output-content').innerHTML = `<div class="error">${errorOutput}</div>`;
                    }
                    // Highlight error line in editor
                    highlightErrorLine(errorPos.line, errorMessage);
                }
                
                console.error('Execution error:', error);
                return result;
            }
        }

        function executeCode() {
            const code = getEditorValue();
            if (!code.trim()) {
                return;
            }

            // Clear output immediately when execution starts
            document.getElementById('output-content').innerHTML = '<div style="color: #666; font-style: italic;">ÂÆüË°å‰∏≠...</div>';
            
            // Reset execution state immediately
            lastExecutedCode = '';
            lastExecutionResult = null;
            window.generatedJS = '';
            window.generatedPython = '';
            
            const loadingEl = document.getElementById('loading');
            
            // Clear previous error highlights
            clearErrorHighlights();
            
            loadingEl.style.display = 'block';
            outputs = [];
            
            setTimeout(() => {
                lastExecutedCode = code;
                lastExecutionResult = executeCodeInternal(code, true);
                
                // Store global references for backward compatibility
                if (lastExecutionResult.success) {
                    window.generatedJS = lastExecutionResult.jsCode;
                    window.generatedPython = lastExecutionResult.pyCode;
                } else {
                    window.generatedJS = lastExecutionResult.jsCode;
                    window.generatedPython = lastExecutionResult.pyCode;
                }

                loadingEl.style.display = 'none';
            }, 100);
        }

        function clearOutput() {
            // Reset execution state
            lastExecutedCode = '';
            lastExecutionResult = null;
            outputs = [];
            window.generatedJS = '';
            window.generatedPython = '';
            
            // Clear error highlights
            clearErrorHighlights();
            
            // Reset display
            document.getElementById('output-content').innerHTML = '<div style="color: #666; font-style: italic;">„Éó„É≠„Ç∞„É©„É†„ÇíÂÆüË°å„Åô„Çã„Å®ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
            
            // Switch to output tab
            if (currentTab !== 'output') {
                currentTab = 'output';
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('.tab').classList.add('active');
            }
        }

        function ensureCodeExecuted() {
            const currentCode = getEditorValue();
            
            // Check if code has changed since last execution
            if (currentCode !== lastExecutedCode || !lastExecutionResult) {
                // Re-execute the code
                outputs = [];
                clearErrorHighlights();
                
                const loadingEl = document.getElementById('loading');
                loadingEl.style.display = 'block';
                
                setTimeout(() => {
                    lastExecutedCode = currentCode;
                    lastExecutionResult = executeCodeInternal(currentCode, false);
                    
                    // Update current tab display
                    updateCurrentTabContent();
                    loadingEl.style.display = 'none';
                }, 50);
            } else {
                // Code hasn't changed, just update display
                updateCurrentTabContent();
            }
        }

        function updateCurrentTabContent() {
            const content = document.getElementById('output-content');
            
            if (!lastExecutionResult) {
                content.innerHTML = '<div style="color: #666; font-style: italic;">„Éó„É≠„Ç∞„É©„É†„ÇíÂÆüË°å„Åô„Çã„Å®ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
                return;
            }

            if (currentTab === 'output') {
                if (lastExecutionResult.success) {
                    content.innerHTML = `<div class="output-content">${escapeHtml(lastExecutionResult.output)}</div>`;
                } else {
                    content.innerHTML = `<div class="error">${lastExecutionResult.output}</div>`;
                    if (lastExecutionResult.errorPos) {
                        highlightErrorLine(lastExecutionResult.errorPos.line, lastExecutionResult.errorMessage);
                    }
                }
            } else if (currentTab === 'javascript') {
                const jsCode = lastExecutionResult.jsCode || '// „Ç≥„Éº„Éâ„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                console.log('Displaying JS tab, code length:', jsCode.length);
                console.log('JS Code preview (first 200 chars):', jsCode.substring(0, 200));
                content.innerHTML = `<div class="json-output">${escapeHtml(jsCode)}</div>`;
            } else if (currentTab === 'python') {
                const pyCode = lastExecutionResult.pyCode || '# „Ç≥„Éº„Éâ„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                console.log('Displaying Python tab, code length:', pyCode.length);
                console.log('Python Code preview (first 200 chars):', pyCode.substring(0, 200));
                content.innerHTML = `<div class="json-output">${escapeHtml(pyCode)}</div>`;
            }

            // Update global variables for backward compatibility
            if (lastExecutionResult.success) {
                window.generatedJS = lastExecutionResult.jsCode;
                window.generatedPython = lastExecutionResult.pyCode;
            }
        }

        function switchTab(tab) {
            // Update tab appearance
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            currentTab = tab;
            
            // Ensure code is executed and synchronized with current editor content
            ensureCodeExecuted();
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark');
            
            if (monacoEditor) {
                monaco.editor.setTheme(isDarkTheme ? 'nanako-dark' : 'nanako-light');
            }
            
            localStorage.setItem('nanako-theme', isDarkTheme ? 'dark' : 'light');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize resizer
        let isResizing = false;
        const resizer = document.getElementById('resizer');
        const editorPanel = document.querySelector('.editor-panel');
        const outputPanel = document.querySelector('.output-panel');

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', stopResize);
        });

        function handleResize(e) {
            if (!isResizing) return;
            
            const containerWidth = document.querySelector('.main-container').offsetWidth;
            const newLeftWidth = (e.clientX / containerWidth) * 100;
            
            if (newLeftWidth > 20 && newLeftWidth < 80) {
                editorPanel.style.width = newLeftWidth + '%';
                outputPanel.style.width = (100 - newLeftWidth) + '%';
            }
        }

        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', stopResize);
        }

        // Add keyboard shortcut for fallback editor
        document.getElementById('fallback-editor').addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                executeCode();
            }
        });

        // Load theme from localStorage
        const savedTheme = localStorage.getItem('nanako-theme');
        if (savedTheme === 'dark') {
            toggleTheme();
        }

        // Auto-execute on page load with delay
        setTimeout(() => {
            executeCode();
        }, 1000);
    </script>
</body>
</html>